from base import Base
import torch
from transformers import AutoTokenizer, AutoModelWithLMHead
from PyPDF2 import PdfReader


class GT5(Base):

    def get_summary(self, document):
        tokenizer = AutoTokenizer.from_pretrained('t5-base')
        model = AutoModelWithLMHead.from_pretrained('t5-base', return_dict=True)
        inputs = tokenizer.encode("summarize: " + text, return_tensors='pt', max_length=512, truncation=True)

        inputs = tokenizer.encode("summarize: " + """TITLE: Analytical mapping of opinion mining and sentiment analysis research during 20 0 0–2015 

AUTHORS:  R. Piryani, D. Madhavi, V.K. Singh

JOURNAL: Information Processing and Management

YEAR: 2017

VOLUME: Information Processing and Management 53 (2017) 122–150

ABSTRACT: The new transformed read-write Web has resulted in a rapid growth of user generated content on the Web resulting into a huge volume of unstructured data. A substantial part of this data is unstructured text such as reviews and blogs. Opinion mining and sentiment analysis (OMSA) as a research discipline has emerged during last 15 years and provides a methodology to computationally process the unstructured data mainly to extract opinions and identify their sentiments. The relatively new but fast growing research discipline has changed a lot during these years. This paper presents a scientometric analysis of research work done on OMSA during 20 0 0–2016. For the scientometric mapping, research publica- tions indexed in Web of Science (WoS) database are used as input data. The publication data is analyzed computationally to identify year-wise publication pattern, rate of growth of publications, types of authorship of papers on OMSA, collaboration patterns in publi- cations on OMSA, most productive countries, institutions, journals and authors, citation patterns and an year-wise citation reference network, and theme density plots and key- word bursts in OMSA publications during the period. A somewhat detailed manual anal- ysis of the data is also performed to identify popular approaches (machine learning and lexicon-based) used in these publications, levels (document, sentence or aspect-level) of sentiment analysis work done and major application areas of OMSA. The paper presents a detailed analytical mapping of OMSA research work and charts the progress of discipline on various useful parameters.

INTRODUCTION: OMSA is a natural language processing task that uses an algorithmic formulation to identify opinionated content and categorize it as having 'positive', 'negative' or 'neutral' polarity. “What other people think”has always been an important piece of information for most of us during the decision-making process ( Pang & Lee, 2008 ). Opinions of users not only help individuals in taking informed decisions but also help organizations in identifying customer attitudes/ opinions about prod- ucts/ services. The new user-centric, participative Web allows extremely large number of users to express themselves about virtually endless topics ranging from reviews about movies, products, services to different socio-political events. However, the immense volume of data available on the Web (including various social media platforms) becomes information overload in absence of automated methods to extract relevant and comprehensive information. OMSA fills this gap by identifying opinionated content and producing opinion summaries. It has been this major reason that research work on OMSA has grown tremendously during the recent past. In this paper, we present a scientometric mapping exercise to analyze and chart the progress of research work in OMSA. The primary motivation of our work has been to understand the trajectory of research work done on OMSA from the period of inception till now. We have used both computational and manual analysis for this purpose. The research publication data obtained from Web of Science (WoS) database is analyzed computationally to identify year-wise number and rate of growth of publications, types of authorship of papers on OMSA, collaboration patterns in publications on OMSA, most productive countries, institutions, journals and authors, citation patterns and an year-wise citation reference network, and theme den- sity plots and keyword bursts in OMSA publications during the period. Thereafter a somewhat detailed manual analysis of the research publication data is performed to identify popular approaches (machine learning and lexicon-based) used in these publications, levels (document, sentence or aspect-level) of sentiment analysis work done and major application areas of OMSA. This analysis is aimed to provide an analytical account of progress of the discipline from its inception to state of the art today, major milestones in the journey, the disciplines that OMSA research has drawn inspiration from and the areas it has been applied, major approaches and methods used in the OMSA research, and a meme map of major concepts and keywords in the area. More precisely, our analytical mapping can answer research questions of the following types: What is the period of origin of OMSA research publications and how research work on OMSA has grown over time? In which countries and institutions most of the initial and subsequent research work on OMSA has been done? What are the top publication sources (journals) publishing research on OMSA? Who are most productive and most cited authors in OMSA research during the period under study? What is the amount of international collaboration in OMSA research? What kind of authorship patterns are observed in OMSA research output? What are the major concepts occurring in OMSA research publications and what kind of theme density plot is observed in OMSA research output? What are the main approaches and methods of OMSA and which of them is used in what proportion of the reported research output? What are the main data sources on which OMSA work is done? What are main application areas of OMSA research? The paper tries to answer the questions of the type mentioned above. Knowing answer to these questions may be very useful for an understanding the origin and growth of research work in OMSA. It will help in charting the course of devel- opment of the discipline and analyze different aspects of OMSA research. The readers can trace the broader landscape of OMSA research filed and obtain a highly useful overview and understanding of the research discipline, from its origin to the current state of the art. To the best of our knowledge this work is first of its kind and is different from regular survey papers on OMSA in many respects. The rest of the paper is organized as follows: Section 2 describes the data collection and analytical methodology used. Section 3 presents analytical outcomes of the scientometric mapping of OMSA research. Section 4 presents a detailed/ manual analysis of OMSA approaches and levels, major data sources and application areas. The paper concludes in Section 5 , with a short summary of the work and its usefulness.

CONCLUSION: In this paper, we have performed a comprehensive scientometric as well as detailed manual analysis of research out- put in OMSA published in SCIE journals during 20 0 0–2015. The research publication dataset has been computationally and manually analyzed to map the OMSA research landscape during last 16 years. The scientometric analysis helped in iden- tify year-wise number and rate of growth of publications, types of authorship of papers on OMSA, collaboration patterns in publications on OMSA, most productive countries, institutions, journals and authors, citation patterns and an year-wise citation reference network, and theme density plots and keyword bursts in OMSA publications during the period. The man- ual analysis helped in identifying popular approaches (machine learning and lexicon-based) used in these publications, levels (document, sentence or aspect-level) of sentiment analysis work done and major application areas of OMSA. The analysis has successfully provided an analytical account of progress of the discipline from its inception to state of the art today, major milestones in the journey, the disciplines that OMSA research has drawn inspiration from and the areas it has been applied, major approaches and methods used in the OMSA research, and a meme map of major concepts and keywords in the area. This computational and manual analysis provided us the answers to various research questions stated in Section 1 . First of all, year-wise growth pattern indicates that there is a constant and significant growth in research output on OMSA (with number of publications doubling every two years). The country-wise distribution of OMSA research shows that OMSA re- search is now geographically widespread, though China and United States of America still produce most of the research papers. In terms of International Collaborative Paper (ICP) instances, China and United States of America again stand at the top with most ICP instances as well as the strongest collaboration link during the period. This study also identifies that the most productive institutions in OMSA research are Chinese Academy of Sciences (according to TP), MIT (according to ACCP) and Chinese Academy of Sciences (according to h -index). We also observe that the top publication sources are Expert System with Applications (according to TP), Computational Linguistics (according to ACCP) and Expert System with Appli- cations and IEEE Transactions on Affective Computing (according to H-index). The analysis identifies Cambria Erik as the most productive and Thelwall Mike as the most cited author on OMSA research. On authorship pattern, we identify that there are more multi-authored publications in OMSA than single authored publications. The analysis further identifies that OMSA publications are in wide variety of disciplines. A control term-based analysis identifies social media, microblogging, emotion, topic modeling, machine learning etc. as important terms seen in the research output, which is further elaborated by Burst detection algorithm. The computational results present a first of its kind analytical overview of the OMSA research area. Researchers in the area can benefit a lot from these results. The manual analysis helped in answering other research important questions. We observe that more OMSA research output is based on machine learning approach (67.20% of the output) as compared to lexicon-based approach (27.15% of the output). Further, more OMSA work is seen on document-level sentiment analysis (92.44% for machine learning approach and 65.22% for lexicon-based approach). It is also observed that reviews constitute the most frequently worked on dataset for OMSA research followed by twitter and news articles. The analysis helps in identifying the primary application areas/ domain in which OMSA work is being done. We can observe that OMSA as a research area is both growing rapidly and has applications in a wide variety of areas. Overall, this paper presents a detailed analytical account of OMSA research during 20 0 0–2015 by computationally and manually analyzing the research publication data in OMSA. The paper helps in understanding the broader landscape of OMSA research and presented results useful for researchers (and those planning to start research) in the area. The analytical results are, to the best of our knowledge, are first of their kind. The results would be useful from various perspectives to researchers/ professionals working in the area.""", return_tensors='pt', max_length=10000, truncation=True)

        summary_ids = model.generate(inputs, max_length=1000, min_length=800, length_penalty=5., num_beams=2)
        summary = tokenizer.decode(summary_ids[0])
        return summary


    def get_summaries(self, pdf_docs):
        #llm = OpenAI(temperature=1)
        
        summaries = []
        text_splitter = RecursiveCharacterTextSplitter(chunk_size=2000, chunk_overlap=400)

        for i,pdf in enumerate(pdf_docs):
            text = ''
            pdf_reader = PdfReader(pdf)
            for pages in pdf_reader.pages:
                text += pages.extract_text()
            document = [Document(page_content=text)]
            # summaries.append("\n\nRESEARCH PAPER "+ str(i) +":\n\n"+self.get_summary(document,llm,text_splitter))
            summaries.append(self.get_summary(document)+"\n\n")
        return summaries
